# Testing Guide - Modern Admin Styler V2

This guide covers the comprehensive testing strategy for the REST API migration project.

## Test Coverage Goals

- **Overall Coverage**: 80% minimum
- **PHP Coverage**: 80% minimum  
- **JavaScript Coverage**: 80% minimum
- **Critical Path Coverage**: 95% minimum

## Test Structure

```
tests/
├── php/
│   ├── unit/                    # Unit tests for individual classes
│   ├── integration/             # Integration tests for workflows
│   ├── rest-api/               # REST API endpoint tests
│   └── e2e/                    # End-to-end tests
├── js/                         # JavaScript tests (Jest)
├── coverage/                   # Coverage reports
├── helpers/                    # Test helper classes
└── manual-qa-checklist.md      # Manual QA checklist
```

## Running Tests

### All Tests
```bash
./tests/run-all-tests.sh
```

### PHP Tests Only
```bash
vendor/bin/phpunit
```

### JavaScript Tests Only
```bash
npm test
```

### With Coverage
```bash
vendor/bin/phpunit --coverage-html tests/coverage/html
npm test -- --coverage
```

## Test Types

### 1. Unit Tests
Test individual classes and methods in isolation.

**Location**: `tests/php/unit/`

**Examples**:
- `TestMASValidationService.php` - Input validation
- `TestMASCacheService.php` - Caching functionality
- `TestMASRateLimiterService.php` - Rate limiting

### 2. Integration Tests
Test complete workflows and service interactions.

**Location**: `tests/php/integration/`

**Examples**:
- Settings save workflow
- Theme application workflow
- Backup and restore workflow

### 3. REST API Tests
Test all REST API endpoints with various scenarios.

**Location**: `tests/php/rest-api/`

**Coverage**:
- Authentication and authorization
- Input validation
- Error handling
- Response formatting

### 4. End-to-End Tests
Test complete user workflows from start to finish.

**Location**: `tests/php/e2e/`

**Scenarios**:
- Complete settings management
- Theme switching workflow
- Backup/restore cycle
- Import/export workflow

### 5. JavaScript Tests
Test client-side functionality and REST API integration.

**Location**: `tests/js/`

**Coverage**:
- REST client functionality
- Error handling
- Fallback mechanisms
- UI interactions

## Quality Assurance

### Automated QA Tests
```bash
php tests/qa-automation.php
```

**Checks**:
- Endpoint availability
- Authentication requirements
- Input validation
- Performance requirements
- Error handling

### Manual QA Checklist
Use `tests/manual-qa-checklist.md` for comprehensive manual testing.

**Areas Covered**:
- User role testing
- Cross-browser compatibility
- Performance testing
- Security testing
- Edge case scenarios

### Performance Testing
```bash
php tests/performance-test.php
```

**Metrics**:
- Response times
- Memory usage
- Concurrent request handling
- Cache effectiveness

## Coverage Analysis

### Generate Coverage Report
```bash
php tests/coverage-analysis.php
```

### Coverage Requirements
- **Controllers**: 85% minimum
- **Services**: 90% minimum
- **Validation**: 95% minimum
- **Critical paths**: 100%

### Coverage Reports
- **PHP**: `tests/coverage/html/index.html`
- **JavaScript**: `coverage/lcov-report/index.html`
- **Combined**: Generated by coverage analysis script

## Continuous Integration

### GitHub Actions
The CI pipeline runs automatically on:
- Push to main/develop branches
- Pull requests
- Manual triggers

### CI Stages
1. **Code Quality**: ESLint, PHPStan, PHPCS
2. **Unit Tests**: PHP and JavaScript
3. **Integration Tests**: Full workflow testing
4. **Coverage Check**: Ensure 80% minimum
5. **Security Scan**: Dependency vulnerabilities

### Matrix Testing
- **PHP Versions**: 7.4, 8.0, 8.1, 8.2
- **WordPress Versions**: 5.9, 6.0, 6.1, 6.2, 6.3, 6.4
- **Node Versions**: 16, 18, 20

## Test Data Management

### Fixtures
Test fixtures are managed in `tests/helpers/class-mas-test-fixtures.php`:
- Sample settings configurations
- Test themes
- Mock backup data
- User accounts

### Database
Tests use isolated test database:
- Automatic setup/teardown
- No impact on development data
- Consistent test environment

## Debugging Tests

### PHPUnit Debugging
```bash
vendor/bin/phpunit --debug
vendor/bin/phpunit --filter=test_specific_method
```

### Jest Debugging
```bash
npm test -- --verbose
npm test -- --watch
```

### Common Issues
1. **Database connection**: Check test database setup
2. **WordPress loading**: Verify bootstrap configuration
3. **Permissions**: Ensure test user has correct capabilities
4. **Timeouts**: Increase timeout for slow operations

## Best Practices

### Writing Tests
1. **Arrange-Act-Assert** pattern
2. **Descriptive test names**
3. **One assertion per test** (when possible)
4. **Clean up after tests**
5. **Use meaningful test data**

### Test Organization
1. **Group related tests** in test classes
2. **Use setUp/tearDown** for common operations
3. **Mock external dependencies**
4. **Test both success and failure paths**

### Performance
1. **Keep tests fast** (< 1 second each)
2. **Use database transactions** for rollback
3. **Mock expensive operations**
4. **Parallel test execution** where possible

## Reporting

### Test Reports
- **JUnit XML**: For CI integration
- **HTML Coverage**: For detailed analysis
- **JSON Reports**: For programmatic access

### Metrics Tracking
- **Coverage trends**: Track over time
- **Performance benchmarks**: Compare releases
- **Failure rates**: Monitor test stability

## Maintenance

### Regular Tasks
1. **Update test data** as features change
2. **Review coverage gaps** monthly
3. **Update CI matrix** for new versions
4. **Refactor slow tests** quarterly

### Test Review
- **Code review** includes test changes
- **Coverage impact** assessment
- **Performance impact** monitoring
- **Maintenance burden** evaluation

## Troubleshooting

### Common Test Failures
1. **Authentication issues**: Check nonce generation
2. **Database errors**: Verify test database setup
3. **Timeout errors**: Increase test timeouts
4. **Memory issues**: Check for memory leaks

### Getting Help
1. Check test output for specific errors
2. Review test logs in CI
3. Use debugging tools (Xdebug, Chrome DevTools)
4. Consult team documentation

## Success Criteria

### Definition of Done
- [ ] All tests pass
- [ ] Coverage goals met (80%+)
- [ ] Performance requirements met
- [ ] Security tests pass
- [ ] Manual QA checklist complete
- [ ] CI pipeline green
- [ ] Documentation updated

### Release Readiness
- [ ] Full test suite passes
- [ ] Coverage reports generated
- [ ] Performance benchmarks met
- [ ] Security audit complete
- [ ] Cross-browser testing done
- [ ] Backward compatibility verified
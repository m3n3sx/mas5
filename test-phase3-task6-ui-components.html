<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3 Task 6 - UI Components Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f0f0f1;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #1d2327;
            margin-bottom: 20px;
        }

        .test-section {
            background: white;
            border: 1px solid #c3c4c7;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #1d2327;
            margin-bottom: 15px;
            font-size: 18px;
        }

        /* Tab Styles */
        .mas-tabs {
            margin-bottom: 20px;
        }

        .mas-tab-list {
            display: flex;
            gap: 5px;
            border-bottom: 1px solid #c3c4c7;
            list-style: none;
        }

        .mas-tab-button {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid transparent;
            border-bottom: none;
            cursor: pointer;
            font-size: 14px;
            color: #50575e;
            position: relative;
            top: 1px;
        }

        .mas-tab-button:hover {
            color: #2271b1;
        }

        .mas-tab-button.active {
            background: white;
            border-color: #c3c4c7;
            color: #1d2327;
            font-weight: 600;
        }

        .mas-tab-button:focus {
            outline: 2px solid #2271b1;
            outline-offset: -2px;
        }

        .mas-tab-badge {
            display: inline-block;
            background: #d63638;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            margin-left: 5px;
        }

        .mas-tab-panel {
            padding: 20px;
            background: white;
        }

        .mas-tab-panel[hidden] {
            display: none;
        }

        /* Theme Selector Styles */
        .mas-theme-selector {
            padding: 20px;
        }

        .mas-theme-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .mas-theme-selector-header h3 {
            margin: 0;
        }

        .mas-theme-filter {
            display: flex;
            gap: 5px;
        }

        .mas-filter-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #c3c4c7;
            cursor: pointer;
            font-size: 13px;
        }

        .mas-filter-btn.active {
            background: #2271b1;
            color: white;
            border-color: #2271b1;
        }

        .mas-theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .mas-theme-card {
            border: 1px solid #c3c4c7;
            border-radius: 4px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .mas-theme-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .mas-theme-card.active {
            border-color: #2271b1;
            border-width: 2px;
        }

        .mas-theme-preview {
            height: 120px;
            display: flex;
            padding: 10px;
            gap: 10px;
        }

        .mas-theme-preview-menu {
            width: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        .mas-theme-preview-content {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .mas-theme-info {
            padding: 15px;
            background: white;
        }

        .mas-theme-name {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .mas-theme-type {
            font-size: 12px;
            color: #646970;
            text-transform: uppercase;
        }

        .mas-theme-badge {
            display: inline-block;
            background: #00a32a;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-top: 5px;
        }

        .mas-theme-actions {
            padding: 10px 15px;
            background: #f6f7f7;
            display: flex;
            gap: 5px;
        }

        /* Backup Manager Styles */
        .mas-backup-manager {
            padding: 20px;
        }

        .mas-backup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .mas-backup-header h3 {
            margin: 0;
        }

        .mas-backup-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #f6f7f7;
            border-radius: 4px;
        }

        .mas-backup-sort {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mas-backup-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mas-backup-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border: 1px solid #c3c4c7;
            border-radius: 4px;
        }

        .mas-backup-icon {
            font-size: 24px;
            color: #646970;
        }

        .mas-backup-details {
            flex: 1;
        }

        .mas-backup-date {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .mas-backup-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
        }

        .mas-backup-type {
            padding: 2px 8px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .mas-backup-type.automatic {
            background: #f0f6fc;
            color: #0a4b78;
        }

        .mas-backup-type.manual {
            background: #f6f7f7;
            color: #1d2327;
        }

        .mas-backup-info-small {
            font-size: 11px;
            color: #646970;
            margin-top: 5px;
        }

        .mas-backup-actions {
            display: flex;
            gap: 5px;
        }

        .mas-backup-empty {
            text-align: center;
            padding: 40px;
            color: #646970;
        }

        .mas-backup-empty .dashicons {
            font-size: 48px;
            margin-bottom: 10px;
        }

        /* Button Styles */
        .mas-btn {
            padding: 8px 16px;
            border: 1px solid #2271b1;
            background: #2271b1;
            color: white;
            cursor: pointer;
            border-radius: 3px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .mas-btn:hover {
            background: #135e96;
            border-color: #135e96;
        }

        .mas-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mas-btn-secondary {
            background: white;
            color: #2271b1;
        }

        .mas-btn-secondary:hover {
            background: #f6f7f7;
        }

        .mas-btn-danger {
            background: #d63638;
            border-color: #d63638;
            color: white;
        }

        .mas-btn-danger:hover {
            background: #b32d2e;
            border-color: #b32d2e;
        }

        .mas-btn-icon {
            padding: 4px 8px;
            background: transparent;
            border: 1px solid #c3c4c7;
            cursor: pointer;
        }

        .dashicons {
            width: 20px;
            height: 20px;
            font-size: 20px;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #2271b1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notice {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid;
        }

        .notice-error {
            background: #fcf0f1;
            border-color: #d63638;
        }

        .notice-success {
            background: #edfaef;
            border-color: #00a32a;
        }

        /* Test Controls */
        .test-controls {
            background: #f6f7f7;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .test-controls h3 {
            margin-bottom: 10px;
        }

        .test-controls button {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        #test-log {
            background: #1d2327;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-entry.error {
            color: #ff6b6b;
        }

        .log-entry.success {
            color: #51cf66;
        }

        .log-entry.info {
            color: #74c0fc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Phase 3 Task 6 - UI Components Test</h1>

        <div class="test-controls">
            <h3>Test Controls</h3>
            <button class="mas-btn" onclick="testTabManager()">Test Tab Manager</button>
            <button class="mas-btn" onclick="testThemeSelector()">Test Theme Selector</button>
            <button class="mas-btn" onclick="testBackupManager()">Test Backup Manager</button>
            <button class="mas-btn mas-btn-secondary" onclick="clearLog()">Clear Log</button>
        </div>

        <!-- Tab Manager Test -->
        <div class="test-section">
            <h2>1. Tab Manager Component</h2>
            <div class="mas-tabs" id="test-tabs">
                <div role="tablist" class="mas-tab-list">
                    <button role="tab" aria-controls="tab-general" class="mas-tab-button">
                        General
                    </button>
                    <button role="tab" aria-controls="tab-themes" class="mas-tab-button">
                        Themes
                    </button>
                    <button role="tab" aria-controls="tab-backups" class="mas-tab-button">
                        Backups
                    </button>
                    <button role="tab" aria-controls="tab-advanced" class="mas-tab-button">
                        Advanced
                    </button>
                </div>

                <div role="tabpanel" id="tab-general" class="mas-tab-panel">
                    <h3>General Settings</h3>
                    <p>This is the general settings panel. Use arrow keys to navigate between tabs.</p>
                </div>

                <div role="tabpanel" id="tab-themes" class="mas-tab-panel" hidden>
                    <h3>Theme Settings</h3>
                    <div id="mas-theme-selector"></div>
                </div>

                <div role="tabpanel" id="tab-backups" class="mas-tab-panel" hidden>
                    <h3>Backup Management</h3>
                    <div id="mas-backup-manager"></div>
                </div>

                <div role="tabpanel" id="tab-advanced" class="mas-tab-panel" hidden>
                    <h3>Advanced Settings</h3>
                    <p>Advanced configuration options go here.</p>
                </div>
            </div>
        </div>

        <!-- Test Log -->
        <div class="test-section">
            <h2>Test Log</h2>
            <div id="test-log"></div>
        </div>
    </div>

    <!-- Load Core Classes -->
    <script src="assets/js/core/EventBus.js"></script>
    <script src="assets/js/core/StateManager.js"></script>
    <script src="assets/js/mas-rest-client.js"></script>
    <script src="assets/js/core/APIClient.js"></script>
    <script src="assets/js/core/ErrorHandler.js"></script>

    <!-- Load Component Base -->
    <script src="assets/js/components/Component.js"></script>

    <!-- Load UI Components -->
    <script src="assets/js/components/TabManager.js"></script>
    <script src="assets/js/components/ThemeSelectorComponent.js"></script>
    <script src="assets/js/components/BackupManagerComponent.js"></script>

    <script>
        // Mock WordPress API settings
        window.wpApiSettings = {
            root: 'http://localhost/wp-json/',
            nonce: 'test-nonce-12345'
        };

        // Test log
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        // Initialize components
        let eventBus, stateManager, apiClient;
        let tabManager, themeSelector, backupManager;

        function initializeCore() {
            log('Initializing core systems...', 'info');

            // Create core instances
            eventBus = new EventBus();
            stateManager = new StateManager(eventBus);
            apiClient = new APIClient({
                debug: true,
                useAjaxFallback: false
            });

            // Mock API responses
            mockAPIResponses();

            log('Core systems initialized', 'success');
        }

        function mockAPIResponses() {
            // Mock getThemes
            const originalGetThemes = apiClient.getThemes.bind(apiClient);
            apiClient.getThemes = async function() {
                log('API: getThemes() called', 'info');
                return {
                    data: [
                        {
                            id: 'dark-blue',
                            name: 'Dark Blue',
                            type: 'predefined',
                            settings: {
                                menu_background: '#1e1e2e',
                                menu_text_color: '#ffffff'
                            }
                        },
                        {
                            id: 'light-gray',
                            name: 'Light Gray',
                            type: 'predefined',
                            settings: {
                                menu_background: '#f0f0f1',
                                menu_text_color: '#1d2327'
                            }
                        },
                        {
                            id: 'custom-1',
                            name: 'My Custom Theme',
                            type: 'custom',
                            settings: {
                                menu_background: '#2d2d44',
                                menu_text_color: '#ffffff'
                            }
                        }
                    ]
                };
            };

            // Mock listBackups
            apiClient.listBackups = async function() {
                log('API: listBackups() called', 'info');
                return {
                    data: [
                        {
                            id: 1,
                            timestamp: Math.floor(Date.now() / 1000) - 3600,
                            type: 'automatic',
                            metadata: {
                                plugin_version: '2.3.0',
                                wordpress_version: '6.8',
                                note: 'Automatic backup'
                            }
                        },
                        {
                            id: 2,
                            timestamp: Math.floor(Date.now() / 1000) - 7200,
                            type: 'manual',
                            metadata: {
                                plugin_version: '2.3.0',
                                wordpress_version: '6.8',
                                note: 'Before major changes'
                            }
                        },
                        {
                            id: 3,
                            timestamp: Math.floor(Date.now() / 1000) - 86400,
                            type: 'automatic',
                            metadata: {
                                plugin_version: '2.2.0',
                                wordpress_version: '6.7',
                                note: 'Daily backup'
                            }
                        }
                    ]
                };
            };

            // Mock applyTheme
            apiClient.applyTheme = async function(themeId) {
                log(`API: applyTheme(${themeId}) called`, 'info');
                return {
                    success: true,
                    data: {
                        settings: { current_theme: themeId }
                    }
                };
            };

            // Mock createBackup
            apiClient.createBackup = async function(options) {
                log('API: createBackup() called', 'info');
                return {
                    success: true,
                    data: {
                        id: Date.now(),
                        timestamp: Math.floor(Date.now() / 1000),
                        type: options.type || 'manual',
                        metadata: {
                            plugin_version: '2.3.0',
                            wordpress_version: '6.8',
                            note: options.note || 'Manual backup'
                        }
                    }
                };
            };

            // Mock restoreBackup
            apiClient.restoreBackup = async function(backupId) {
                log(`API: restoreBackup(${backupId}) called`, 'info');
                return {
                    success: true,
                    data: {
                        settings: {}
                    }
                };
            };

            // Mock deleteBackup
            apiClient.deleteBackup = async function(backupId) {
                log(`API: deleteBackup(${backupId}) called`, 'info');
                return {
                    success: true
                };
            };
        }

        function initializeComponents() {
            log('Initializing UI components...', 'info');

            // Tab Manager
            const tabsElement = document.getElementById('test-tabs');
            if (tabsElement) {
                tabManager = new TabManager(tabsElement, apiClient, stateManager, eventBus);
                tabManager.setupAccessibility();
                log('TabManager initialized', 'success');
            }

            // Theme Selector
            const themeSelectorElement = document.getElementById('mas-theme-selector');
            if (themeSelectorElement) {
                themeSelector = new ThemeSelectorComponent(themeSelectorElement, apiClient, stateManager, eventBus);
                log('ThemeSelectorComponent initialized', 'success');
            }

            // Backup Manager
            const backupManagerElement = document.getElementById('mas-backup-manager');
            if (backupManagerElement) {
                backupManager = new BackupManagerComponent(backupManagerElement, apiClient, stateManager, eventBus);
                log('BackupManagerComponent initialized', 'success');
            }

            // Subscribe to events
            eventBus.on('tab:changed', (data) => {
                log(`Tab changed to: ${data.tabId}`, 'info');
            });

            eventBus.on('theme:applied', (data) => {
                log(`Theme applied: ${data.themeId}`, 'success');
            });

            eventBus.on('backup:created', (data) => {
                log('Backup created successfully', 'success');
            });

            eventBus.on('notification:show', (data) => {
                log(`Notification: [${data.type}] ${data.message}`, data.type === 'error' ? 'error' : 'success');
            });
        }

        // Test functions
        function testTabManager() {
            log('=== Testing Tab Manager ===', 'info');
            
            if (!tabManager) {
                log('TabManager not initialized', 'error');
                return;
            }

            log(`Active tab: ${tabManager.getActiveTab()}`, 'info');
            log(`Total tabs: ${tabManager.getTabs().length}`, 'info');

            // Test tab switching
            setTimeout(() => {
                log('Switching to themes tab...', 'info');
                tabManager.activateTab('tab-themes');
            }, 1000);

            setTimeout(() => {
                log('Adding badge to backups tab...', 'info');
                tabManager.addBadge('tab-backups', '3');
            }, 2000);

            setTimeout(() => {
                log('Switching to backups tab...', 'info');
                tabManager.activateTab('tab-backups');
            }, 3000);

            log('Tab Manager test sequence started', 'success');
        }

        function testThemeSelector() {
            log('=== Testing Theme Selector ===', 'info');
            
            if (!themeSelector) {
                log('ThemeSelectorComponent not initialized', 'error');
                return;
            }

            // Switch to themes tab first
            if (tabManager) {
                tabManager.activateTab('tab-themes');
            }

            const state = themeSelector.getState();
            log(`Loaded ${state.themes.length} themes`, 'info');
            log(`Current theme: ${state.currentTheme}`, 'info');

            log('Theme Selector test complete', 'success');
        }

        function testBackupManager() {
            log('=== Testing Backup Manager ===', 'info');
            
            if (!backupManager) {
                log('BackupManagerComponent not initialized', 'error');
                return;
            }

            // Switch to backups tab first
            if (tabManager) {
                tabManager.activateTab('tab-backups');
            }

            const state = backupManager.getState();
            log(`Loaded ${state.backups.length} backups`, 'info');
            log(`Sort by: ${state.sortBy} (${state.sortOrder})`, 'info');

            log('Backup Manager test complete', 'success');
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, initializing...', 'info');
            initializeCore();
            initializeComponents();
            log('All components ready!', 'success');
            log('Try using arrow keys to navigate tabs, or click the test buttons above', 'info');
        });
    </script>
</body>
</html>
